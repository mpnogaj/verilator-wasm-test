<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Verilator Lint MVP (Web Worker)</title>
	<style>
		body {
			font-family: sans-serif;
			line-height: 1.6;
			background: #f4f4f4;
			color: #333;
			padding: 20px;
		}

		h1 {
			border-bottom: 2px solid #00599c;
			padding-bottom: 10px;
		}

		#output-console {
			font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
			background: #1e1e1e;
			color: #d4d4d4;
			padding: 20px;
			border-radius: 8px;
			white-space: pre-wrap;
			word-wrap: break-word;
			min-height: 400px;
		}
	</style>
</head>

<body>

	<h1>Verilator Lint Output:</h1>
	<pre id="output-console"></pre>

	<button id="lint-button">Start Linting</button>

	<script>
		const outputElement = document.getElementById('output-console');

		function logToUI(text) {
			outputElement.textContent += text + "\n";
		}

		logToUI("Main Page: Initializing...");

		logToUI("Main Page: Starting lint_worker.js...");
		const worker = new Worker('lint_worker.js');

		worker.onmessage = (e) => {
			const data = e.data;

			switch (data.type) {
				case 'log':
					logToUI(data.text);
					break;
				case 'done':
					logToUI("Main Page: Worker has signaled completion.");
					break;
			}
		};

		worker.onerror = (e) => {
			logToUI(`Main Page: CRITICAL ERROR in worker: ${e.message} (File: ${e.filename}, Line: ${e.lineno})`);
		};

		document.getElementById('lint-button').onclick = () => {
			logToUI("Main Page: Sending lint request to worker...");

			const verilogFiles = {
			 "top.v": `
module top(input logic a, output logic b);
	assign b = a;
endmodule
`,
			 "unused.v": `
module unused(input logic x);
	top u_top(.a(x), .b(_));
endmodule`
			};
			worker.postMessage({ type: 'lint', files: verilogFiles });
		}
	</script>

</body>

</html>